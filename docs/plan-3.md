–≠—Ç–æ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –≥–æ–ª–æ—Å–æ–≤—ã—Ö –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤ ‚Äî **–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞**, –ø–æ–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç—è–∂—ë–ª–∞—è –∏–ª–∏ –¥–æ–ª–≥–∞—è –∑–∞–¥–∞—á–∞. –ß—Ç–æ–±—ã —ç—Ç–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –∏ –ø—Ä–∏ —ç—Ç–æ–º —Å–æ–∑–¥–∞—Ç—å **–º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—É—é, –±—ã—Å—Ç—Ä—É—é –∏ —á–∏—Å—Ç—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É**, —è –ø–æ–∫–∞–∂—É —Ç–µ–±–µ:

---

### üß† –ß—Ç–æ –∏–º–µ–Ω–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

–ö–æ–≥–¥–∞ —Ç—ã –∑–∞–ø—É—Å–∫–∞–µ—à—å –∫–∞–∫—É—é-—Ç–æ —Ñ—É–Ω–∫—Ü–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, `process_text()`), –æ–Ω–∞ **–∑–∞–Ω–∏–º–∞–µ—Ç –ø–æ—Ç–æ–∫**, –≤ –∫–æ—Ç–æ—Ä–æ–º –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–æ—Å–ª—É—à–∫–∞ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞. –ü–æ—ç—Ç–æ–º—É –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç **–ø–µ—Ä–µ—Å—Ç–∞—ë—Ç —Å–ª—É—à–∞—Ç—å**, –ø–æ–∫–∞ –∑–∞–¥–∞—á–∞ –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è.

---

### ‚úÖ –†–µ—à–µ–Ω–∏—è (–ø–æ –ø–æ—Ä—è–¥–∫—É –æ—Ç –ø—Ä–æ—Å—Ç–æ–≥–æ –∫ –±–æ–ª–µ–µ –º–æ—â–Ω–æ–º—É):

#### 1. üîÅ **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ** —Å `asyncio.create_task`

–ï—Å–ª–∏ —Ç–≤–æ–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —Å–ª—É—à–∞–µ—Ç –≥–æ–ª–æ—Å **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ**, —Ç—ã –º–æ–∂–µ—à—å –∫–∞–∂–¥—É—é —Ñ—É–Ω–∫—Ü–∏—é –≤—ã–ø–æ–ª–Ω—è—Ç—å **–æ—Ç–¥–µ–ª—å–Ω–æ–π –∑–∞–¥–∞—á–µ–π**, –Ω–µ –±–ª–æ–∫–∏—Ä—É—è –≥–ª–∞–≤–Ω—ã–π —Ü–∏–∫–ª:

```python
import asyncio

async def handle_command(command):
    # —Ç—É—Ç –¥–ª–∏–Ω–Ω–∞—è –∑–∞–¥–∞—á–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å –∫ –ò–ò, API, –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–∞)
    await asyncio.sleep(3)
    print(f"Command completed: {command}")

async def on_text_received(text):
    print(f"Received: {text}")
    asyncio.create_task(handle_command(text))  # –ù–ï –ñ–î–Å–¢, –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
```

> üî• –ü–æ–ª–µ–∑–Ω–æ, –µ—Å–ª–∏ —Ç—ã —Ö–æ—á–µ—à—å, —á—Ç–æ–±—ã –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —Å–ª—É—à–∞–ª —Ç–µ–±—è **–ø–æ–∫–∞** –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–∞.

---

#### 2. ‚öôÔ∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **ThreadPoolExecutor** (–µ—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è)

–ï—Å–ª–∏ —Ç–≤–æ—è —Ñ—É–Ω–∫—Ü–∏—è, –Ω–∞–ø—Ä–∏–º–µ—Ä, –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, —Å–∫–∞—á–∏–≤–∞–µ—Ç —á—Ç–æ-—Ç–æ, –¥–µ–ª–∞–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ ‚Äî —Ç–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π **–æ—Ç–¥–µ–ª—å–Ω—ã–π –ø–æ—Ç–æ–∫**:

```python
from concurrent.futures import ThreadPoolExecutor
import asyncio

executor = ThreadPoolExecutor()

def long_blocking_task(command):
    import time
    time.sleep(5)
    print(f"Done: {command}")

async def on_text_received(text):
    loop = asyncio.get_event_loop()
    loop.run_in_executor(executor, long_blocking_task, text)
```

> üí° –ü–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å —Ç—è–∂—ë–ª—É—é —Ñ—É–Ω–∫—Ü–∏—é –∏ **–Ω–µ –º–µ—à–∞—Ç—å –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—É —Å–ª—É—à–∞—Ç—å –≥–æ–ª–æ—Å.**

---

#### 3. üß± –ò—Å–ø–æ–ª—å–∑—É–π **–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞–º–∏ –∏ –æ—á–µ—Ä–µ–¥—è–º–∏**

–°–æ–∑–¥–∞–π **@process\_command** ‚Äî –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—É –≤ –æ—á–µ—Ä–µ–¥—å –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –µ—ë, –Ω–µ –º–µ—à–∞—è –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—É:

```python
import asyncio
from functools import wraps

command_queue = asyncio.Queue()

def process_command(func):
    @wraps(func)
    async def wrapper(*args, **kwargs):
        await command_queue.put((func, args, kwargs))
    return wrapper

async def command_worker():
    while True:
        func, args, kwargs = await command_queue.get()
        try:
            await func(*args, **kwargs)
        finally:
            command_queue.task_done()

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
@process_command
async def play_music(song_name):
    print(f"Playing {song_name}")
    await asyncio.sleep(3)
```

> ‚úÖ –≠—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –∫–æ–º–∞–Ω–¥ **—Ä–∞–∑–≥—Ä—É–∑–∏—Ç—å**, —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å!

---

### üéÅ –ß—Ç–æ –µ—â—ë –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç:

#### üì¶ –£–¥–æ–±–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

| –§—É–Ω–∫—Ü–∏—è              | –û–ø–∏—Å–∞–Ω–∏–µ                                                |
| -------------------- | ------------------------------------------------------- |
| `@log_command`       | –õ–æ–≥–∏—Ä—É–µ—Ç –∫–æ–º–∞–Ω–¥—ã –≤ —Ñ–∞–π–ª/–±–∞–∑—É                            |
| `@cooldown(3)`       | –ù–µ –≤—ã–ø–æ–ª–Ω—è—Ç—å –æ–¥–Ω—É –∏ —Ç—É –∂–µ –∫–æ–º–∞–Ω–¥—É —á–∞—â–µ, —á–µ–º —Ä–∞–∑ –≤ 3 —Å–µ–∫ |
| `@require_internet`  | –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç                             |
| `@retry(times=3)`    | –ü–æ–≤—Ç–æ—Ä—è–µ—Ç –∫–æ–º–∞–Ω–¥—É, –µ—Å–ª–∏ –±—ã–ª–∞ –æ—à–∏–±–∫–∞                     |
| `@voice_response`    | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–∑–≤—É—á–∏–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç                      |
| `@only_if_logged_in` | –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω        |

#### üß± –ö–ª–∞—Å—Å—ã –∏ –º–æ–¥—É–ª–∏

–†–∞–∑–¥–µ–ª–∏ –∫–æ–¥ –Ω–∞ –∫–ª–∞—Å—Å—ã:

* `SpeechRecognizer`: —Ç–æ–ª—å–∫–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏
* `VoiceCommandRouter`: –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã –∏ –≤—ã–∑—ã–≤–∞–µ—Ç –Ω—É–∂–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
* `CommandExecutor`: –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ–º–∞–Ω–¥—ã, —Ö—Ä–∞–Ω–∏—Ç –æ—á–µ—Ä–µ–¥—å
* `UserSessionManager`: –µ—Å–ª–∏ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ä–∞–∑–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

#### üí° –ü—Ä–∏–º–µ—Ä —É–¥–æ–±–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:

```
assistant/
‚îÇ
‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îú‚îÄ‚îÄ recognizer.py      # —Å–ª—É—à–∞–µ—Ç –≥–æ–ª–æ—Å
‚îÇ   ‚îú‚îÄ‚îÄ executor.py        # async –æ—á–µ—Ä–µ–¥—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ decorators.py      # @log, @retry –∏ —Ç.–¥.
‚îÇ   ‚îî‚îÄ‚îÄ router.py          # –∫–æ–º–∞–Ω–¥—ã –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è
‚îÇ
‚îú‚îÄ‚îÄ commands/
‚îÇ   ‚îú‚îÄ‚îÄ system.py          # –∫–æ–º–∞–Ω–¥—ã —Ç–∏–ø–∞ "–≤—ã–∫–ª—é—á–∏ –∫–æ–º–ø—å—é—Ç–µ—Ä"
‚îÇ   ‚îú‚îÄ‚îÄ ai.py              # –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –ò–ò
‚îÇ   ‚îî‚îÄ‚îÄ media.py           # –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –º—É–∑—ã–∫–∏, –≤–∏–¥–µ–æ –∏ —Ç.–¥.
‚îÇ
‚îî‚îÄ‚îÄ main.py                # –∑–∞–ø—É—Å–∫ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞
```

---

–•–æ—á–µ—à—å ‚Äî —è –º–æ–≥—É –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–º–µ—Ä —Ç–∞–∫–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã, –∏ —Ç—ã —Å–º–æ–∂–µ—à—å –Ω–∞—á–∞—Ç—å –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞—Ç—å —Å–≤–æ–π –ø—Ä–æ–µ–∫—Ç –ø–æ –Ω–µ–π.
–ù–∞–ø–∏—à–∏: `–°–æ–∑–¥–∞–π –º–Ω–µ –ø—Ä–∏–º–µ—Ä –ø—Ä–æ–µ–∫—Ç–∞ —Å —Ç–∞–∫–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π`.
